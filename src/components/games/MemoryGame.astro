---
import MemoryGameClient from "@components/games/memory/MemoryGameClient"
import { getImage } from "astro:assets"

// Import cards from src/
const raw = import.meta.glob(
    "../../images/memory/cards/*.{png,jpg,jpeg,webp,avif}",
    {
        eager: true,
        import: "default",
    },
)

// Define realistic sizes for cards
const widths = [64, 96, 128, 192, 256]

const cards = await Promise.all(
    Object.entries(raw).map(async ([path, meta]) => {
        const img = await getImage({
            src: meta as ImageMetadata,
            widths,
            sizes: "(max-width: 640px) 22vw, (max-width: 1024px) 12vw, 96px",
            formats: ["avif", "webp"],
            quality: 75,
        })

        const name = path.split("/").pop()?.split(".")[0] ?? "card"

        return {
            id: name,
            alt: name,
            src: img.src,
            srcSet: img.attributes.srcset,
            sizes: img.attributes.sizes,
            width: img.attributes.width,
            height: img.attributes.height,
        }
    }),
)
---

<MemoryGameClient client:load cards={cards} />
