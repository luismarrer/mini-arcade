<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Test Board Update</title>
    <style>
        body { 
            padding: 20px; 
            font-family: monospace; 
        }
        .status { 
            margin: 10px 0; 
            padding: 10px; 
            background: #f0f0f0; 
        }
        .game-board {
            display: grid;
            grid-template-columns: repeat(3, 60px);
            grid-template-rows: repeat(3, 60px);
            gap: 1px;
            background: #333;
            width: fit-content;
            margin: 20px 0;
        }
        .cell {
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
        }
    </style>
</head>
<body>
    <h1>Test Board Update</h1>
    <div id="status" class="status">Cargando...</div>
    <div id="game-board" class="game-board"></div>
    <button id="test-move">Probar Movimiento Player</button>
    <button id="test-computer">Probar Movimiento Computer</button>
    <button id="reset-board">Reiniciar Tablero</button>
    <div id="logs"></div>
    
    <script type="module">
        import { gameState, setGameState } from './js/state.js'
        import { getInitialState } from './js/storage.js'
        import { updateBoardDisplay } from './js/ui.js'
        import { makeMove } from './js/gameLogic.js'
        
        const statusDiv = document.getElementById('status');
        const logsDiv = document.getElementById('logs');
        
        function addLog(message) {
            const log = document.createElement('div');
            log.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logsDiv.appendChild(log);
        }
        
        // Inicializar el estado
        const initialState = getInitialState();
        setGameState(initialState);
        addLog('Estado inicial creado');
        addLog('Board inicial: ' + JSON.stringify(initialState.board));
        
        // Actualizar el tablero
        updateBoardDisplay(initialState);
        statusDiv.textContent = 'Tablero inicial mostrado';
        addLog('updateBoardDisplay llamado con estado inicial');
        
        // Verificar que el tablero se actualizó
        const cells = document.querySelectorAll('.cell');
        addLog(`Celdas creadas: ${cells.length}`);
        
        const pawns = document.querySelectorAll('.pawn');
        addLog(`Peones creados: ${pawns.length}`);
        
        // Probar un movimiento del jugador
        document.getElementById('test-move').addEventListener('click', () => {
            addLog('=== Probando movimiento del JUGADOR ===');
            const currentState = gameState;
            addLog('Estado actual: ' + JSON.stringify(currentState?.currentPlayer));
            
            const move = {
                from: { row: 2, col: 1 },
                to: { row: 1, col: 1 },
                isCapture: false
            };
            
            addLog('Movimiento: ' + JSON.stringify(move));
            const newState = makeMove(move);
            
            if (newState) {
                addLog('Nuevo estado creado');
                addLog('Board nuevo: ' + JSON.stringify(newState.board));
                addLog('Turno nuevo: ' + newState.currentPlayer);
                setGameState(newState);
                updateBoardDisplay(newState);
                addLog('updateBoardDisplay llamado con nuevo estado');
                
                const newPawns = document.querySelectorAll('.pawn');
                addLog(`Peones después del movimiento: ${newPawns.length}`);
                
                statusDiv.textContent = `Movimiento ejecutado - Turno: ${newState.currentPlayer}`;
            } else {
                addLog('ERROR: makeMove devolvió null');
                statusDiv.textContent = 'Error en el movimiento';
            }
        });
        
        // Probar movimiento de la computadora
        document.getElementById('test-computer').addEventListener('click', () => {
            addLog('=== Probando movimiento de la COMPUTADORA ===');
            const currentState = gameState;
            
            if (currentState?.currentPlayer === 'computer') {
                const move = {
                    from: { row: 0, col: 1 },
                    to: { row: 1, col: 1 },
                    isCapture: false
                };
                
                addLog('Movimiento computer: ' + JSON.stringify(move));
                const newState = makeMove(move);
                
                if (newState) {
                    addLog('Nuevo estado creado por computer');
                    setGameState(newState);
                    updateBoardDisplay(newState);
                    statusDiv.textContent = `Movimiento computer - Turno: ${newState.currentPlayer}`;
                }
            } else {
                addLog('No es el turno de la computadora');
                statusDiv.textContent = 'No es turno de la computadora';
            }
        });
        
        // Reiniciar tablero
        document.getElementById('reset-board').addEventListener('click', () => {
            addLog('=== REINICIANDO TABLERO ===');
            const newState = getInitialState();
            setGameState(newState);
            updateBoardDisplay(newState);
            statusDiv.textContent = 'Tablero reiniciado';
            addLog('Tablero reiniciado al estado inicial');
        });
    </script>
</body>
</html>
